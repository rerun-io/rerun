[project]
name = "rerun-workspace"
version = "0.28.0-alpha.1+dev"
description = "Rerun Python workspace"
requires-python = ">=3.10,<3.13"

[dependency-groups]
dev = [
  # Even though it would be convenient to do so, we can't include `rerun-sdk`
  # in our dev dependencies here. The isolation of the uv build interacts
  # poorly with maturin build causing significant, spurious rebuilds.
  #
  # Instead, we combine with `maturin dev` to install into the dev environment.
  #"rerun-sdk",
  #"rerun_notebook",
  "maturin>=1.0.0",
  "ruff==0.12.10",
  "mypy==1.14.1",
  "nbqa==1.9.1",
  # Type stubs for mypy
  "pandas-stubs==2.3.3.251201",
  "types-requests==2.32.4.20250913",
  "types-tqdm==4.67.0.20250809",
  "types-colorama>=0.4.15",
  "types-Pillow>=10.0.0",
  # Typed packages needed for linting scripts/examples
  "attrs>=23.1.0",
  "semver>=3.0,<3.1",
  "tomlkit>=0.12",
  "GitPython>=3.1",
  "PyGithub>=2.0",
  "Jinja2>=3.1",
  "rich>=13.0",
  # Testing packages (typed, needed for linting tests)
  "pytest>=8.0",
  "inline-snapshot>=0.31",
  "syrupy>=4.0",
]

[tool.uv]
package = false

[tool.uv.sources]
rerun-sdk = { workspace = true }
rerun-notebook = { workspace = true }

[tool.uv.workspace]
members = ["rerun_py", "rerun_notebook"]

[tool.ruff]
src = ["rerun_py", "rerun_py/rerun_sdk", "rerun_notebook"]
extend-exclude = [
  "crates",
  "target",
  ".venv",

  # Automatically generated test artifacts
  "target_ra/",
  "target_wasm/",
  "target/",
  "venv/",

  "scripts/ci/compare_path_digest.py",

  # Intentionally uses ''' instead of """ so we can embed it in a docstring in the Python API docs.
  "docs/snippets/all/archetypes/text_document.py",
  "docs/snippets/all/views/text_document.py",

  # TODO(#4047): incomplete example snippet
  "docs/snippets/all/tutorials/timelines_example.py",

  # Intentionally incomplete snippets
  "docs/snippets/all/concepts/how_helix_was_logged.py",
  "docs/snippets/all/concepts/static",
  "docs/snippets/all/tutorials/custom-application-id.py",
  "docs/snippets/all/tutorials/custom-recording-id.py",

  # generated
  "examples/python/objectron/objectron/proto/objectron/proto.py",

  # Copied from https://github.com/huggingface/diffusers/blob/fc9fecc217e58d72c0d5796575c72088251ff4df/src/diffusers/pipelines/stable_diffusion/pipeline_stable_diffusion_depth2img.py
  "examples/python/depth_guided_stable_diffusion/depth_guided_stable_diffusion/huggingface_pipeline.py",

  # Copied from https://github.com/colmap/colmap/blob/bf3e19140f491c3042bfd85b7192ef7d249808ec/scripts/python/read_write_model.py
  "examples/python/structure_from_motion/structure_from_motion/read_write_model.py",
]

[tool.ruff.lint.per-file-ignores]
"docs/snippets/all/*" = [
  # Missing required import: `from __future__ import annotations`
  "I002",
]

"crates/viewer/re_viewer/data/quick_start_guides/*" = [
  # Missing required import: `from __future__ import annotations`
  "I002",
]

"tests/python/*" = [
  # We don't care about nice APIs in our tests:
  "PLR0917",
]

"examples/notebook/notebook_neural_field_2d/neural_field_2d.ipynb" = [
  # Intentional use of  `Ïƒ`
  "RUF001",
]

"examples/*" = [
  # We don't care about nice APIs in our examples:
  "PLR0917",
]
"scripts/*" = [
  # We don't care about nice APIs in our scripts:
  "PLR0917",
]

######################
# mypy configuration #
######################

[tool.mypy]
# Examples and docs are managed independently of the SDK.
# in ini file adjacent to this.
files = [
  "rerun_py/rerun_sdk/rerun",
  "rerun_py/rerun_bindings",
  "rerun_py/tests",
  "rerun_notebook/src/rerun_notebook",
  "tests/python",
]
# These paths allow mypy to find rerun and rerun_bindings without needing
# to run maturin develop first (which installs the .pth file).
mypy_path = ["rerun_py", "rerun_py/rerun_sdk"]
namespace_packages = true
show_error_codes = true
strict = true
enable_error_code = ["redundant-expr", "truthy-bool", "ignore-without-code", "possibly-undefined"]
ignore_missing_imports = false
no_implicit_reexport = false
disallow_untyped_calls = false

[[tool.mypy.overrides]]

module = [
  "pyarrow.*",
  # TODO(nick): remove datafusion/notebook after #10696 lands
  "datafusion.*",
  "rerun_notebook.*",
  # https://github.com/jupyter-widgets/ipywidgets/issues/3688
  "ipywidgets.*",
  "anywidget.*",
  # TODO(nick): is this blocked on above?
  "jupyter_ui_poll.*",
  # Ignore imports used in tests but not in the SDK.
  "torch.*",
  "torchvision.*",
  "torchaudio.*",
  "cv2.*",
  "rerun.*",
  "huggingface_hub.*",
  "polars.*",
]
ignore_missing_imports = true

[[tool.mypy.overrides]]
# rerun_draft is a sandbox for testing new APIs - we don't care about strict type checking
module = ["api_sandbox.rerun_draft.*", "rerun_draft.*"]
ignore_errors = true
ignore_missing_imports = true
