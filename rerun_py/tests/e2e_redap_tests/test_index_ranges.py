from __future__ import annotations

from typing import TYPE_CHECKING

from inline_snapshot import snapshot as inline_snapshot

if TYPE_CHECKING:
    from rerun.catalog import DatasetEntry


def test_index_ranges(readonly_test_dataset: DatasetEntry) -> None:
    df = (
        readonly_test_dataset.get_index_ranges()
        .sort("rerun_segment_id")
        .select(
            "rerun_segment_id",
            "log_tick:start",
            "log_tick:end",
            "log_time:start",
            "log_time:end",
            "time_1:start",
            "time_1:end",
            "time_2:start",
            "time_2:end",
            "time_3:start",
            "time_3:end",
        )
        .limit(10)
    )

    assert str(df) == inline_snapshot("""\
┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ METADATA:                                                                                                                                                                                                                                                                                                                  │
│ * version: 0.1.3                                                                                                                                                                                                                                                                                                           │
├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┤
│ ┌──────────────────────────────────┬──────────────────────┬──────────────────────┬──────────────────────────────┬──────────────────────────────┬───────────────────────────────┬───────────────────────────────┬─────────────────────────────┬─────────────────────────────┬──────────────────────┬──────────────────────┐ │
│ │ rerun_segment_id                 ┆ log_tick:start       ┆ log_tick:end         ┆ log_time:start               ┆ log_time:end                 ┆ time_1:start                  ┆ time_1:end                    ┆ time_2:start                ┆ time_2:end                  ┆ time_3:start         ┆ time_3:end           │ │
│ │ ---                              ┆ ---                  ┆ ---                  ┆ ---                          ┆ ---                          ┆ ---                           ┆ ---                           ┆ ---                         ┆ ---                         ┆ ---                  ┆ ---                  │ │
│ │ type: Utf8                       ┆ type: nullable i64   ┆ type: nullable i64   ┆ type: nullable Timestamp(ns) ┆ type: nullable Timestamp(ns) ┆ type: nullable Timestamp(ns)  ┆ type: nullable Timestamp(ns)  ┆ type: nullable Duration(ns) ┆ type: nullable Duration(ns) ┆ type: nullable i64   ┆ type: nullable i64   │ │
│ │                                  ┆ index: log_tick      ┆ index: log_tick      ┆ index: log_time              ┆ index: log_time              ┆ index: time_1                 ┆ index: time_1                 ┆ index: time_2               ┆ index: time_2               ┆ index: time_3        ┆ index: time_3        │ │
│ │                                  ┆ index_kind: sequence ┆ index_kind: sequence ┆ index_kind: timestamp        ┆ index_kind: timestamp        ┆ index_kind: timestamp         ┆ index_kind: timestamp         ┆ index_kind: duration        ┆ index_kind: duration        ┆ index_kind: sequence ┆ index_kind: sequence │ │
│ │                                  ┆ index_marker: start  ┆ index_marker: end    ┆ index_marker: start          ┆ index_marker: end            ┆ index_marker: start           ┆ index_marker: end             ┆ index_marker: start         ┆ index_marker: end           ┆ index_marker: start  ┆ index_marker: end    │ │
│ │                                  ┆ kind: index          ┆ kind: index          ┆ kind: index                  ┆ kind: index                  ┆ kind: index                   ┆ kind: index                   ┆ kind: index                 ┆ kind: index                 ┆ kind: index          ┆ kind: index          │ │
│ ╞══════════════════════════════════╪══════════════════════╪══════════════════════╪══════════════════════════════╪══════════════════════════════╪═══════════════════════════════╪═══════════════════════════════╪═════════════════════════════╪═════════════════════════════╪══════════════════════╪══════════════════════╡ │
│ │ 141a866deb2d49f69eb3215e8a404ffc ┆ 1                    ┆ 115                  ┆ 2025-11-03T20:35:21.079585   ┆ 2025-11-03T20:35:21.081253   ┆ 2024-01-15T10:30:45.123456789 ┆ 2024-01-15T12:04:45.123456789 ┆ PT1800S                     ┆ PT16200S                    ┆ 1                    ┆ 50                   │ │
│ ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┤ │
│ │ 24598969c97a4154a1ad0a262ee31b97 ┆ 1                    ┆ 57                   ┆ 2025-11-03T20:35:21.088656   ┆ 2025-11-03T20:35:21.089483   ┆ 2024-01-15T10:30:45.123456789 ┆ 2024-01-15T11:18:45.123456789 ┆ PT1800S                     ┆ PT9000S                     ┆ 1                    ┆ 22                   │ │
│ ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┤ │
│ │ 3ee345b2e801448cace33a1097b9b49b ┆ 1                    ┆ 60                   ┆ 2025-11-03T20:35:21.077357   ┆ 2025-11-03T20:35:21.078218   ┆ 2024-01-15T10:30:45.123456789 ┆ 2024-01-15T11:18:45.123456789 ┆ PT1800S                     ┆ PT9000S                     ┆ 1                    ┆ 25                   │ │
│ ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┤ │
│ │ 45e562f3abc24cfbbcf49ad30fa04b47 ┆ 1                    ┆ 58                   ┆ 2025-11-03T20:35:21.053657   ┆ 2025-11-03T20:35:21.054504   ┆ 2024-01-15T10:30:45.123456789 ┆ 2024-01-15T11:18:45.123456789 ┆ PT1800S                     ┆ PT9000S                     ┆ 1                    ┆ 25                   │ │
│ ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┤ │
│ │ 526f111faae1465d865d80e9a5c9eb6d ┆ 1                    ┆ 64                   ┆ 2025-11-03T20:35:21.046720   ┆ 2025-11-03T20:35:21.047718   ┆ 2024-01-15T10:30:45.123456789 ┆ 2024-01-15T11:16:45.123456789 ┆ PT1800S                     ┆ PT9000S                     ┆ 1                    ┆ 25                   │ │
│ ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┤ │
│ │ 68224eead5ed40838b3f3bdb0edfd2b2 ┆ 1                    ┆ 59                   ┆ 2025-11-03T20:35:21.058931   ┆ 2025-11-03T20:35:21.059812   ┆ 2024-01-15T10:30:45.123456789 ┆ 2024-01-15T11:18:45.123456789 ┆ PT1800S                     ┆ PT9000S                     ┆ 1                    ┆ 25                   │ │
│ ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┤ │
│ │ 793d8cf8a1764d9c902bbd6f851e5e43 ┆ 1                    ┆ 63                   ┆ 2025-11-03T20:35:21.083036   ┆ 2025-11-03T20:35:21.083967   ┆ 2024-01-15T10:30:45.123456789 ┆ 2024-01-15T11:16:45.123456789 ┆ PT2100S                     ┆ PT8700S                     ┆ 2                    ┆ 25                   │ │
│ ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┤ │
│ │ 89b618fcbb1e427aa82cd43edb7c3bec ┆ 1                    ┆ 115                  ┆ 2025-11-03T20:35:21.049729   ┆ 2025-11-03T20:35:21.051456   ┆ 2024-01-15T10:30:45.123456789 ┆ 2024-01-15T12:08:45.123456789 ┆ PT1800S                     ┆ PT16500S                    ┆ 1                    ┆ 50                   │ │
│ ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┤ │
│ │ 8a81e65b49a647a592aaf41b4004a381 ┆ 1                    ┆ 117                  ┆ 2025-11-03T20:35:21.073535   ┆ 2025-11-03T20:35:21.075319   ┆ 2024-01-15T10:30:45.123456789 ┆ 2024-01-15T12:08:45.123456789 ┆ PT1800S                     ┆ PT16500S                    ┆ 1                    ┆ 49                   │ │
│ ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┤ │
│ │ 909bfa81104c4b7b82f49b3dd3e8653e ┆ 1                    ┆ 58                   ┆ 2025-11-03T20:35:21.064523   ┆ 2025-11-03T20:35:21.065506   ┆ 2024-01-15T10:30:45.123456789 ┆ 2024-01-15T11:18:45.123456789 ┆ PT1800S                     ┆ PT9000S                     ┆ 3                    ┆ 25                   │ │
│ └──────────────────────────────────┴──────────────────────┴──────────────────────┴──────────────────────────────┴──────────────────────────────┴───────────────────────────────┴───────────────────────────────┴─────────────────────────────┴─────────────────────────────┴──────────────────────┴──────────────────────┘ │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘\
""")


def test_index_ranges_dataset_view(readonly_test_dataset: DatasetEntry) -> None:
    view = readonly_test_dataset.filter_segments([
        "141a866deb2d49f69eb3215e8a404ffc",
        "3ee345b2e801448cace33a1097b9b49b",
    ])
    readonly_test_dataset.reader(index="log_tick").show()
    column_orders = [
        "rerun_segment_id",
        "log_tick:start",
        "log_tick:end",
        "log_time:start",
        "log_time:end",
        "time_1:start",
        "time_1:end",
        "time_2:start",
        "time_2:end",
        "time_3:start",
        "time_3:end",
    ]

    df = view.get_index_ranges().sort("rerun_segment_id").select(*column_orders)

    assert str(df) == inline_snapshot("""\
┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ METADATA:                                                                                                                                                                                                                                                                                                                  │
│ * version: 0.1.3                                                                                                                                                                                                                                                                                                           │
├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┤
│ ┌──────────────────────────────────┬──────────────────────┬──────────────────────┬──────────────────────────────┬──────────────────────────────┬───────────────────────────────┬───────────────────────────────┬─────────────────────────────┬─────────────────────────────┬──────────────────────┬──────────────────────┐ │
│ │ rerun_segment_id                 ┆ log_tick:start       ┆ log_tick:end         ┆ log_time:start               ┆ log_time:end                 ┆ time_1:start                  ┆ time_1:end                    ┆ time_2:start                ┆ time_2:end                  ┆ time_3:start         ┆ time_3:end           │ │
│ │ ---                              ┆ ---                  ┆ ---                  ┆ ---                          ┆ ---                          ┆ ---                           ┆ ---                           ┆ ---                         ┆ ---                         ┆ ---                  ┆ ---                  │ │
│ │ type: Utf8                       ┆ type: nullable i64   ┆ type: nullable i64   ┆ type: nullable Timestamp(ns) ┆ type: nullable Timestamp(ns) ┆ type: nullable Timestamp(ns)  ┆ type: nullable Timestamp(ns)  ┆ type: nullable Duration(ns) ┆ type: nullable Duration(ns) ┆ type: nullable i64   ┆ type: nullable i64   │ │
│ │                                  ┆ index: log_tick      ┆ index: log_tick      ┆ index: log_time              ┆ index: log_time              ┆ index: time_1                 ┆ index: time_1                 ┆ index: time_2               ┆ index: time_2               ┆ index: time_3        ┆ index: time_3        │ │
│ │                                  ┆ index_kind: sequence ┆ index_kind: sequence ┆ index_kind: timestamp        ┆ index_kind: timestamp        ┆ index_kind: timestamp         ┆ index_kind: timestamp         ┆ index_kind: duration        ┆ index_kind: duration        ┆ index_kind: sequence ┆ index_kind: sequence │ │
│ │                                  ┆ index_marker: start  ┆ index_marker: end    ┆ index_marker: start          ┆ index_marker: end            ┆ index_marker: start           ┆ index_marker: end             ┆ index_marker: start         ┆ index_marker: end           ┆ index_marker: start  ┆ index_marker: end    │ │
│ │                                  ┆ kind: index          ┆ kind: index          ┆ kind: index                  ┆ kind: index                  ┆ kind: index                   ┆ kind: index                   ┆ kind: index                 ┆ kind: index                 ┆ kind: index          ┆ kind: index          │ │
│ ╞══════════════════════════════════╪══════════════════════╪══════════════════════╪══════════════════════════════╪══════════════════════════════╪═══════════════════════════════╪═══════════════════════════════╪═════════════════════════════╪═════════════════════════════╪══════════════════════╪══════════════════════╡ │
│ │ 141a866deb2d49f69eb3215e8a404ffc ┆ 1                    ┆ 115                  ┆ 2025-11-03T20:35:21.079585   ┆ 2025-11-03T20:35:21.081253   ┆ 2024-01-15T10:30:45.123456789 ┆ 2024-01-15T12:04:45.123456789 ┆ PT1800S                     ┆ PT16200S                    ┆ 1                    ┆ 50                   │ │
│ ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┤ │
│ │ 3ee345b2e801448cace33a1097b9b49b ┆ 1                    ┆ 60                   ┆ 2025-11-03T20:35:21.077357   ┆ 2025-11-03T20:35:21.078218   ┆ 2024-01-15T10:30:45.123456789 ┆ 2024-01-15T11:18:45.123456789 ┆ PT1800S                     ┆ PT9000S                     ┆ 1                    ┆ 25                   │ │
│ └──────────────────────────────────┴──────────────────────┴──────────────────────┴──────────────────────────────┴──────────────────────────────┴───────────────────────────────┴───────────────────────────────┴─────────────────────────────┴─────────────────────────────┴──────────────────────┴──────────────────────┘ │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘\
""")

    # Note: the ranges are relative to the actual data being filtered, see how the ranges differ here

    view = view.filter_contents(["/obj1:Points3D:positions"])
    df = view.get_index_ranges().sort("rerun_segment_id").select(*column_orders)

    assert str(df) == inline_snapshot("""\
┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ METADATA:                                                                                                                                                                                                                                                                                                                  │
│ * version: 0.1.3                                                                                                                                                                                                                                                                                                           │
├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┤
│ ┌──────────────────────────────────┬──────────────────────┬──────────────────────┬──────────────────────────────┬──────────────────────────────┬───────────────────────────────┬───────────────────────────────┬─────────────────────────────┬─────────────────────────────┬──────────────────────┬──────────────────────┐ │
│ │ rerun_segment_id                 ┆ log_tick:start       ┆ log_tick:end         ┆ log_time:start               ┆ log_time:end                 ┆ time_1:start                  ┆ time_1:end                    ┆ time_2:start                ┆ time_2:end                  ┆ time_3:start         ┆ time_3:end           │ │
│ │ ---                              ┆ ---                  ┆ ---                  ┆ ---                          ┆ ---                          ┆ ---                           ┆ ---                           ┆ ---                         ┆ ---                         ┆ ---                  ┆ ---                  │ │
│ │ type: Utf8                       ┆ type: nullable i64   ┆ type: nullable i64   ┆ type: nullable Timestamp(ns) ┆ type: nullable Timestamp(ns) ┆ type: nullable Timestamp(ns)  ┆ type: nullable Timestamp(ns)  ┆ type: nullable Duration(ns) ┆ type: nullable Duration(ns) ┆ type: nullable i64   ┆ type: nullable i64   │ │
│ │                                  ┆ index: log_tick      ┆ index: log_tick      ┆ index: log_time              ┆ index: log_time              ┆ index: time_1                 ┆ index: time_1                 ┆ index: time_2               ┆ index: time_2               ┆ index: time_3        ┆ index: time_3        │ │
│ │                                  ┆ index_kind: sequence ┆ index_kind: sequence ┆ index_kind: timestamp        ┆ index_kind: timestamp        ┆ index_kind: timestamp         ┆ index_kind: timestamp         ┆ index_kind: duration        ┆ index_kind: duration        ┆ index_kind: sequence ┆ index_kind: sequence │ │
│ │                                  ┆ index_marker: start  ┆ index_marker: end    ┆ index_marker: start          ┆ index_marker: end            ┆ index_marker: start           ┆ index_marker: end             ┆ index_marker: start         ┆ index_marker: end           ┆ index_marker: start  ┆ index_marker: end    │ │
│ │                                  ┆ kind: index          ┆ kind: index          ┆ kind: index                  ┆ kind: index                  ┆ kind: index                   ┆ kind: index                   ┆ kind: index                 ┆ kind: index                 ┆ kind: index          ┆ kind: index          │ │
│ ╞══════════════════════════════════╪══════════════════════╪══════════════════════╪══════════════════════════════╪══════════════════════════════╪═══════════════════════════════╪═══════════════════════════════╪═════════════════════════════╪═════════════════════════════╪══════════════════════╪══════════════════════╡ │
│ │ 141a866deb2d49f69eb3215e8a404ffc ┆ 1                    ┆ 115                  ┆ 2025-11-03T20:35:21.079585   ┆ 2025-11-03T20:35:21.081253   ┆ 2024-01-15T10:30:45.123456789 ┆ 2024-01-15T12:04:45.123456789 ┆ PT1800S                     ┆ PT16200S                    ┆ 1                    ┆ 50                   │ │
│ ├╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┼╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┤ │
│ │ 3ee345b2e801448cace33a1097b9b49b ┆ 1                    ┆ 60                   ┆ 2025-11-03T20:35:21.077357   ┆ 2025-11-03T20:35:21.078218   ┆ 2024-01-15T10:30:45.123456789 ┆ 2024-01-15T11:18:45.123456789 ┆ PT1800S                     ┆ PT9000S                     ┆ 1                    ┆ 25                   │ │
│ └──────────────────────────────────┴──────────────────────┴──────────────────────┴──────────────────────────────┴──────────────────────────────┴───────────────────────────────┴───────────────────────────────┴─────────────────────────────┴─────────────────────────────┴──────────────────────┴──────────────────────┘ │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘\
""")
