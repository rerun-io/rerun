[package]
name = "re_log_types"
version.workspace = true
edition.workspace = true
rust-version.workspace = true
license.workspace = true
publish = false


[features]
default = ["arrow_datagen", "anyhow"]

## Enable loading data from a file.
load = ["anyhow", "rmp-serde", "serde", "zstd", "ruzstd"]

## Add support for some math operations using [`glam`](https://crates.io/crates/glam/).
glam = ["dep:glam", "dep:macaw"]

## Enable saving data to a file.
save = ["anyhow", "rmp-serde", "serde", "zstd"]

## Enable conversions
ecolor = ["dep:ecolor"]

## Enable (de)serialization using serde.
serde = [
  "dep:serde",
  "dep:serde_bytes",
  "half/serde",
  "re_string_interner/serde",
  "re_tuid/serde",
]

## Enables the `datagen` module, which exposes a number of tools for generating random data for
## tests and benchmarks.
arrow_datagen = ["dep:rand"]

## Enables support for converting 2d-tensors into images
image_tensor = ["dep:image"]

[dependencies]

# Rerun
re_log = { path = "../re_log" }
re_string_interner = { path = "../re_string_interner" }
re_tuid = { path = "../re_tuid" }
re_format = { path = "../re_format" }

# External
ahash = "0.8"
arrow2 = { workspace = true, features = ["io_ipc", "io_print"] }
arrow2_convert.workspace = true
bytemuck = "1.11"
chrono = { version = "0.4", features = [
  "js-sys",
  "wasmbind",
] } # TODO(emilk): replace `chrono` with `time` crate
derive_more.workspace = true
document-features = "0.2"
fixed = { version = "1.17", default-features = false, features = ["serde"] }
half = { version = "1.8", features = ["bytemuck"] }
lazy_static.workspace = true
ndarray.workspace = true
nohash-hasher = "0.2"
num-derive = "0.3"
num-traits = "0.2"
thiserror.workspace = true
typenum = "1.15"
uuid = { version = "1.1", features = ["serde", "v4", "js"] }


# Optional dependencies:
anyhow = { workspace = true, optional = true }
ecolor = { workspace = true, optional = true }
glam = { version = "0.20", optional = true }                            # can't update glam until a new version of `macaw` is released
image = { workspace = true, default-features = false, optional = true }
macaw = { version = "0.17", optional = true }
rand = { version = "0.8", optional = true }
rmp-serde = { version = "1", optional = true }
serde = { version = "1", features = ["derive", "rc"], optional = true }
serde_bytes = { version = "0.11", optional = true }

# Native dependencies:
[target.'cfg(not(target_arch = "wasm32"))'.dependencies]
puffin.workspace = true
zstd = { version = "0.11.0", optional = true } # native only

# Web dependencies:
[target.'cfg(target_arch = "wasm32")'.dependencies]
ruzstd = { version = "0.3.0", optional = true } # works on wasm

[dev-dependencies]
criterion = "0.4"
mimalloc = "0.1"
serde_test = { version = "1" }

[lib]
bench = false

[[bench]]
name = "msg_encode_benchmark"
harness = false
