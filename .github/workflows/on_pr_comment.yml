name: "PR Comment"

on:
  issue_comment:
    types: [created, edited]

jobs:
  parse-command:
    if: |
      contains(github.event.comment.html_url, '/pull/') &&
      contains(github.event.comment.body, '@rerun-bot')
    runs-on: ubuntu-latest
    outputs:
      command: ${{ steps.parse.outputs.command }}
    steps:
      - name: Parse comment
        id: parse
        shell: bash
        run: |
          # Parse `@rerun-bot <command>`
          command=$(echo "${{ github.event.comment.body }}" | sed -n 's/.*@rerun-bot[[:space:]]\+\([a-zA-Z\-]*\).*/\1/p')
          echo "command=$command" >> "$GITHUB_OUTPUT"

  trigger-main:
    needs: [parse-command]
    if: needs.parse-command.outputs.command == 'full-check'
    uses: ./.github/workflows/on_push_main.yml
