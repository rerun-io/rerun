name: Reusable PR Link Docs

on:
  workflow_call:
    inputs:
      CONCURRENCY:
        required: true
        type: string
      PR_NUMBER:
        required: true
        type: string

concurrency:
  group: ${{ inputs.CONCURRENCY }}-pr-summary
  cancel-in-progress: true

jobs:
  pr-link-docs:
    name: Link to docs preview in PR

    permissions:
      contents: "read"
      id-token: "write"
      pull-requests: "write"

    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.x

      - name: Install deps
        run: pip install PyGithub # NOLINT

      - name: Link to docs
        run: |
          python scripts/pr_link_docs.py \
          --github-token ${{ secrets.GITHUB_TOKEN }} \
          --github-repository ${GITHUB_REPOSITORY} \
          --pr-number ${{ inputs.PR_NUMBER }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PR_NUMBER: ${{ inputs.PR_NUMBER }}

